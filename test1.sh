#!/bin/bash

# List of node IDs to run in parallel
NODE_IDS=(7482750 7512506 7512512 7512952 7542330 7542769 7603513 7603517 7662518 7662919 7692265 7722041 7722066 7722068 7722069 7752269 7752270 7781886 7781939 7812415 7812443 7841142 7896861 7926406 7926862 7956993 8103479 8133820 8163511 8163545 8163553 8163624 8222910 8252739 8252772 8282648 8342532 8342537 10417821 9759901 8402245 8431896 8431943 8431943 10119726 10178860 10209873 10269189 10299837 10359106 9819806 7812443 6848557 6940382 7085898 7207892 7361139 6641564 7001572 7151530 7121431 7391331 6494831 6494833 7004870 6554567 7095001 7124839 6614527 7424800 7334535 6584825 6524723 7095022 6914724 6854838 6734766 7710283 7740202 7471176 6501798 7590736 6620900 7531066 6741125 7251587 7740218 6771205 6530627 7680396 7501073 6741144 7131320 7281788 7535869 7449070 7286860 7047033 6535482 7136577 7535889 7923640 6889978 6559293 7190074 6739606 7280184 11281138 11160984 10776413 10837017 10921470 11132985)

# Start infinite loop
while true; do
  echo "Starting 120 Nexus nodes..."

  # Start each node in background and record PIDs
  PIDS=()
  for NODE_ID in "${NODE_IDS[@]}"; do
    echo "Starting node $NODE_ID"
    /opt/glibc-2.39/lib/ld-linux-x86-64.so.2 \
      --library-path /opt/glibc-2.39/lib:/opt/glibc-2.39/lib64:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu \
      /root/.nexus/bin/nexus-network start --node-id "$NODE_ID" &
    
    PIDS+=($!)
  done

  echo "All nodes started. Sleeping for 5 minutes..."
  sleep 6000000  # 5 minutes

  echo "Stopping all Nexus nodes..."
  for PID in "${PIDS[@]}"; do
    kill "$PID"
  done

  echo "Cycle complete. Restarting in 5 seconds..."
  sleep 5
done
